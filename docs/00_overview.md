# Signal Factory - í”„ë¡œì íŠ¸ ì´ëŒ

## í”„ë¡œì íŠ¸ ê°œìš”

**í”„ë¡œì íŠ¸ëª…:** signal-factory

**ëª©ì :** ì‹œê³„ì—´ ë°ì´í„°ë¥¼ ê¸°ë°˜ìœ¼ë¡œ ë§¤ë§¤ ì‹ í˜¸ë¥¼ ìƒì„±í•˜ê³  ê°€ìƒ/ì‹¤ì œ ê±°ë˜ë¥¼ ìˆ˜í–‰í•˜ëŠ” ìœ ì—°í•˜ê³  í™•ì¥ ê°€ëŠ¥í•œ íŠ¸ë ˆì´ë”© í”„ë ˆì„ì›Œí¬ êµ¬ì¶•

**í•µì‹¬ ê°€ì¹˜:**
- ìœ ì—°ì„±: ì‚¬ìš©ì ì •ì˜ ë¡œì§ì„ ì‰½ê²Œ ì¶”ê°€/êµì²´ ê°€ëŠ¥
- ì•ˆì „ì„±: ì‹œë®¬ë ˆì´ì…˜ ê²€ì¦ í›„ ì‹¤ê±°ë˜ ì—°ê²°
- ë³´ì•ˆì„±: ìƒŒë“œë°•ìŠ¤ í™˜ê²½ì—ì„œ ê²©ë¦¬ëœ ë¡œì§ ì‹¤í–‰
- ì¬í˜„ì„±: ë²„ì „ ê´€ë¦¬ë¥¼ í†µí•œ ë°±í…ŒìŠ¤íŠ¸ì™€ í¬ì›Œë“œ í…ŒìŠ¤íŠ¸

## ì£¼ìš” êµ¬ì„± ìš”ì†Œ

### 1. ë°ì´í„° íŒŒì´í”„ë¼ì¸
- **ë°ì´í„° ìˆ˜ì§‘ê¸°**: ë‹¤ì–‘í•œ ì†ŒìŠ¤ë¡œë¶€í„° ì‹œê³„ì—´ ë°ì´í„° ìˆ˜ì§‘
- **ì‹œì„¸ ë°œìƒê¸°**: ì›ì‹œ ë°ì´í„°ë¥¼ í‘œì¤€ OHLCV í¬ë§·ìœ¼ë¡œ ë³€í™˜
- **ì‹¤ì‹œê°„ ë³€í™˜ê¸°**: ì‹¤ì‹œê°„ ìŠ¤íŠ¸ë¦¼ì„ ë‚´ë¶€ í‘œì¤€ í¬ë§·ìœ¼ë¡œ ë³€í™˜

ìƒì„¸ ë¬¸ì„œ: [02_data_pipeline.md](./02_data_pipeline.md)

### 2. ì‹ í˜¸ ìƒì„± ì‹œìŠ¤í…œ
- **ë¡œì§ ê´€ë¦¬**: ì‚¬ìš©ì ì •ì˜ JavaScript ë¡œì§ CRUD
- **ë³´ì•ˆ ì‹¤í–‰**: ìƒŒë“œë°•ìŠ¤ í™˜ê²½ì—ì„œ ê²©ë¦¬ëœ ì‹¤í–‰
- **í¬íŠ¸í´ë¦¬ì˜¤**: ì—¬ëŸ¬ ë¡œì§ ì¡°í•© ë° ê°€ì¤‘ì¹˜ ê´€ë¦¬

ìƒì„¸ ë¬¸ì„œ: [03_signal_generation.md](./03_signal_generation.md)

### 3. ì‹¤í–‰ ì—”ì§„
- **ë°±í…ŒìŠ¤íŒ…**: ê³¼ê±° ë°ì´í„°ë¡œ ì„±ëŠ¥ ê²€ì¦
- **ì‹¤ì‹œê°„ ì‹ í˜¸**: ë¼ì´ë¸Œ ë°ì´í„°ë¡œ ì‹ í˜¸ ìƒì„±
- **ìë™ ë§¤ë§¤**: ë¸Œë¡œì»¤ ì—°ë™ì„ í†µí•œ ì‹¤ê±°ë˜

ìƒì„¸ ë¬¸ì„œ: [04_execution_engine.md](./04_execution_engine.md)

### 4. ì‚¬ìš©ì ì¸í„°í˜ì´ìŠ¤
- **ì›¹ UI**: React ê¸°ë°˜ ë°ìŠ¤í¬í†± ì¸í„°í˜ì´ìŠ¤
- **ëª¨ë°”ì¼ ì•±**: Expoë¥¼ í™œìš©í•œ í¬ë¡œìŠ¤ í”Œë«í¼ ì•±

ìƒì„¸ ë¬¸ì„œ: [05_web_ui.md](./05_web_ui.md), [06_mobile_app.md](./06_mobile_app.md)

### 5. ë³´ì•ˆ ë° ìš´ì˜
- **ê²©ë¦¬ í™˜ê²½**: ì»¨í…Œì´ë„ˆ ë° ìƒŒë“œë°•ìŠ¤ ê¸°ë°˜ ê²©ë¦¬
- **ëª¨ë‹ˆí„°ë§**: ë¡œê¹…, ì§€í‘œ, ì•Œë¦¼ ì‹œìŠ¤í…œ
- **ë°°í¬**: ë¶„ì‚° ë° ì„œë²„ë¦¬ìŠ¤ ì•„í‚¤í…ì²˜

ìƒì„¸ ë¬¸ì„œ: [07_security.md](./07_security.md), [08_deployment.md](./08_deployment.md)

## ê¸°ìˆ  ìŠ¤íƒ

### í”„ë¡ íŠ¸ì—”ë“œ
- **ì–¸ì–´**: JavaScript/TypeScript
- **í”„ë ˆì„ì›Œí¬**: React
- **ëª¨ë°”ì¼**: Expo (React Native)
- **UI ë¼ì´ë¸ŒëŸ¬ë¦¬**: Material-UI, Tailwind CSS
- **ì°¨íŠ¸**: TradingView Lightweight Charts, D3.js

### ë°±ì—”ë“œ
- **ì£¼ ì–¸ì–´**: JavaScript/TypeScript (Node.js)
- **ë³´ì¡° ì–¸ì–´**: Python (ë°ì´í„° ì²˜ë¦¬), Rust (ê³ ì„±ëŠ¥ ì»´í¬ë„ŒíŠ¸)
- **API**: RESTful API, GraphQL
- **ëŸ°íƒ€ì„**: Node.js, Deno (ìƒŒë“œë°•ìŠ¤)

### ë°ì´í„° ì €ì¥ì†Œ
- **ê´€ê³„í˜• DB**: PostgreSQL (ë©”íƒ€ë°ì´í„°)
- **ê°ì²´ ìŠ¤í† ë¦¬ì§€**: S3 (ì›ì‹œ ë°ì´í„°, ë°±í…ŒìŠ¤íŠ¸ ê²°ê³¼)
- **ìºì‹œ**: Redis (ì‹¤ì‹œê°„ ìƒíƒœ, ì„¸ì…˜)
- **ì‹œê³„ì—´ DB**: TimescaleDB ë˜ëŠ” InfluxDB (ì„ íƒì )

### ì¸í”„ë¼
- **ì»¨í…Œì´ë„ˆ**: Docker, Kubernetes
- **CI/CD**: GitHub Actions
- **ëª¨ë‹ˆí„°ë§**: Prometheus, Grafana
- **ë¡œê¹…**: ELK Stack ë˜ëŠ” Loki

ìƒì„¸ ë¬¸ì„œ: [11_tech_stack.md](./11_tech_stack.md)

## ë°ì´í„° ëª¨ë¸

### ìµœì í™”ëœ ì‹œì„¸ ë°ì´í„° êµ¬ì¡°

ë°©ëŒ€í•œ ì‹œì„¸ ë°ì´í„°ë¥¼ íš¨ìœ¨ì ìœ¼ë¡œ ì²˜ë¦¬í•˜ê¸° ìœ„í•´ í‚¤ê°’ ë° ë©”íƒ€ë°ì´í„°ë¥¼ ìµœì†Œí™”í•œ êµ¬ì¡° ì„¤ê³„:

```javascript
// ì••ì¶•ëœ ì‹œê³„ì—´ ë°ì´í„° (ë°°ì—´ ê¸°ë°˜)
// [timestamp, open, high, low, close, volume]
const tickData = [
  [1704096600000, 150.0, 151.0, 149.5, 150.5, 1000000],
  [1704096660000, 150.5, 151.5, 150.0, 151.0, 1100000],
  // ...
];

// ë©”íƒ€ë°ì´í„°ëŠ” ë³„ë„ ë¶„ë¦¬
const metadata = {
  symbol: "AAPL",
  interval: "1m",
  timezone: "UTC"
};
```

ìƒì„¸ ë¬¸ì„œ: [10_data_models.md](./10_data_models.md)

## ì•„í‚¤í…ì²˜ íŒ¨í„´

### ë°±ì—”ë“œ-í”„ë¡ íŠ¸ì—”ë“œ ë¶„ë¦¬

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   Web UI        â”‚â”€â”€â”€â”€â–¶â”‚   API Gateway   â”‚
â”‚   (React)       â”‚     â”‚                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                               â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”            â”‚
â”‚   Mobile App    â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚   (Expo)        â”‚            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜            â–¼
                        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                        â”‚  Backend        â”‚
                        â”‚  Services       â”‚
                        â”‚  (Node.js)      â”‚
                        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                               â”‚
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â–¼          â–¼          â–¼
              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”
              â”‚PostgreSQLâ”‚ â”‚ Redis  â”‚ â”‚   S3   â”‚
              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

ìƒì„¸ ë¬¸ì„œ: [01_architecture_overview.md](./01_architecture_overview.md)

## ì‚¬ìš©ì ì›Œí¬í”Œë¡œìš°

### ê¸°ë³¸ ì‚¬ìš© íë¦„

1. **íšŒì›ê°€ì…/ë¡œê·¸ì¸**: ì†Œì…œ ê³„ì • (Google, GitHub ë“±) ì—°ë™
2. **ë¡œì§ ì‘ì„±**: ì›¹ ì—ë””í„°ì—ì„œ JavaScript íŠ¸ë ˆì´ë”© ë¡œì§ ì‘ì„±
3. **í¬íŠ¸í´ë¦¬ì˜¤ êµ¬ì„±**: ì—¬ëŸ¬ ë¡œì§ ì¡°í•© ë° ê°€ì¤‘ì¹˜ ì„¤ì •
4. **ë°±í…ŒìŠ¤íŒ…**: ê³¼ê±° ë°ì´í„°ë¡œ ì„±ëŠ¥ ê²€ì¦
5. **ì‹¤ì‹œê°„ ëª¨ë‹ˆí„°ë§**: ë¼ì´ë¸Œ ë°ì´í„°ë¡œ ì‹ í˜¸ í™•ì¸
6. **ì„ íƒì  ìë™ ë§¤ë§¤**: ê²€ì¦ í›„ ì‹¤ê±°ë˜ ì—°ê²° (ë³„ë„ ë“±ê¸‰)

ìƒì„¸ ë¬¸ì„œ: [12_user_workflows.md](./12_user_workflows.md)

## ê¶Œí•œ ë“±ê¸‰ ë° ë¹„ì¦ˆë‹ˆìŠ¤ ëª¨ë¸

### ë¬´ë£Œ í‹°ì–´
- ë°±í…ŒìŠ¤íŠ¸ ì‹¤í–‰ (ì œí•œì )
- 5ë¶„ ë‹¨ìœ„ íƒ€ì´ë¨¸ ê¸°ë°˜ ì‹ í˜¸ ìƒì„±
- ì´ë©”ì¼ ì•Œë¦¼ 3ê±´/ì¼

### í”„ë¦¬ë¯¸ì—„ í‹°ì–´
- í¬ì›Œë“œ í…ŒìŠ¤íŠ¸ ë¬´ì œí•œ
- ì‹¤ì‹œê°„ ì‹ í˜¸ API ì ‘ê·¼
- ê³ ê¸‰ ì´í‰ ë°ì´í„° ê³µê¸‰
- í‘¸ì‹œ/SMS ì•Œë¦¼

### ì—”í„°í”„ë¼ì´ì¦ˆ
- ê³„ì¢Œ ìœ„íƒ ê´€ë¦¬ (ë³„ë„ ê³„ì•½)
- ì „ìš© ì¸í”„ë¼
- ì»¤ìŠ¤í…€ ë¸Œë¡œì»¤ ì—°ë™

ìƒì„¸ ë¬¸ì„œ: [13_business_model.md](./13_business_model.md)

## ê°œë°œ ë¡œë“œë§µ

### Phase 1: ê¸°ì´ˆ ì¸í”„ë¼ (1-2ê°œì›”)
- [x] í”„ë¡œì íŠ¸ êµ¬ì¡°í™” ë° ë¬¸ì„œí™”
- [ ] ë°ì´í„° íŒŒì´í”„ë¼ì¸ êµ¬ì¶•
- [ ] ë¡œì§ ì¸í„°í˜ì´ìŠ¤ ë° ìƒŒë“œë°•ìŠ¤ í”„ë¡œí† íƒ€ì…

### Phase 2: í•µì‹¬ ê¸°ëŠ¥ (2-3ê°œì›”)
- [ ] ì›¹ UI ê°œë°œ (ë¡œì§ ì—ë””í„°, ëª©ë¡)
- [ ] í¬íŠ¸í´ë¦¬ì˜¤ ê´€ë¦¬ ì‹œìŠ¤í…œ
- [ ] ë°±í…ŒìŠ¤íŒ… ì—”ì§„

### Phase 3: ì‹¤ì‹œê°„ ê¸°ëŠ¥ (2-3ê°œì›”)
- [ ] ì‹¤ì‹œê°„ ë°ì´í„° ì—°ë™
- [ ] ì‹ í˜¸ ìƒì„± ë° ëª¨ë‹ˆí„°ë§ ëŒ€ì‹œë³´ë“œ
- [ ] ëª¨ë°”ì¼ ì•± ê°œë°œ

### Phase 4: ìë™ ë§¤ë§¤ (2-3ê°œì›”)
- [ ] ë¸Œë¡œì»¤ ì–´ëŒ‘í„° ê°œë°œ
- [ ] ë¦¬ìŠ¤í¬ ê´€ë¦¬ ì‹œìŠ¤í…œ
- [ ] ìë™ ë§¤ë§¤ ê¸°ëŠ¥

### Phase 5: ìš´ì˜ ë° í™•ì¥ (ì§€ì†)
- [ ] ë³´ì•ˆ ê°•í™” ë° ê°ì‚¬
- [ ] ì„±ëŠ¥ ìµœì í™”
- [ ] ë‹¤ì¤‘ ì–¸ì–´ ì§€ì›

ìƒì„¸ ë¬¸ì„œ: [14_roadmap.md](./14_roadmap.md)

## ë³´ì•ˆ ê³ ë ¤ì‚¬í•­

### ì£¼ìš” ìœ„í˜‘ ë° ëŒ€ì‘

1. **ì•…ì„± ë¡œì§ ì‹¤í–‰**
   - ëŒ€ì‘: ìƒŒë“œë°•ìŠ¤ ê²©ë¦¬, ë¦¬ì†ŒìŠ¤ ì œí•œ, ë„¤íŠ¸ì›Œí¬ ì°¨ë‹¨

2. **ë°ì´í„° ìœ ì¶œ**
   - ëŒ€ì‘: ì•”í˜¸í™”, ì ‘ê·¼ ì œì–´, ê°ì‚¬ ë¡œê¹…

3. **API ì˜¤ë‚¨ìš©**
   - ëŒ€ì‘: Rate limiting, ì¸ì¦/ì¸ê°€, API í‚¤ ê´€ë¦¬

4. **ìë™ ë§¤ë§¤ ë¦¬ìŠ¤í¬**
   - ëŒ€ì‘: í‚¬ ìŠ¤ìœ„ì¹˜, ì†ì‹¤ í•œë„, ìˆ˜ë™ ìŠ¹ì¸ ëª¨ë“œ

ìƒì„¸ ë¬¸ì„œ: [07_security.md](./07_security.md)

## API ëª…ì„¸

### ì£¼ìš” ì—”ë“œí¬ì¸íŠ¸

- `POST /api/v1/logics` - ë¡œì§ ìƒì„±
- `GET /api/v1/logics` - ë¡œì§ ëª©ë¡ ì¡°íšŒ
- `PUT /api/v1/logics/:id` - ë¡œì§ ìˆ˜ì •
- `DELETE /api/v1/logics/:id` - ë¡œì§ ì‚­ì œ
- `POST /api/v1/portfolios` - í¬íŠ¸í´ë¦¬ì˜¤ ìƒì„±
- `POST /api/v1/backtests` - ë°±í…ŒìŠ¤íŠ¸ ì‹¤í–‰
- `GET /api/v1/signals/realtime` - ì‹¤ì‹œê°„ ì‹ í˜¸ ì¡°íšŒ

ìƒì„¸ ë¬¸ì„œ: [09_api_specifications.md](./09_api_specifications.md)

## í…ŒìŠ¤íŒ… ì „ëµ

### ì„œë²„ì¸¡ ë‹¨ìœ„ í…ŒìŠ¤íŠ¸

**í…ŒìŠ¤íŠ¸ í”„ë ˆì„ì›Œí¬:**
- **Jest**: JavaScript/TypeScript ë‹¨ìœ„ í…ŒìŠ¤íŠ¸
- **Supertest**: API ì—”ë“œí¬ì¸íŠ¸ í…ŒìŠ¤íŠ¸
- **pytest**: Python ì»´í¬ë„ŒíŠ¸ í…ŒìŠ¤íŠ¸
- **mockito**: ëª¨í‚¹ ë° ìŠ¤í…

**í…ŒìŠ¤íŠ¸ ëŒ€ìƒ ë° ì»¤ë²„ë¦¬ì§€ ìš”êµ¬ì‚¬í•­:**

1. **API ì—”ë“œí¬ì¸íŠ¸ (í•„ìˆ˜ ì»¤ë²„ë¦¬ì§€ 80%+)**
   - ëª¨ë“  RESTful ì—”ë“œí¬ì¸íŠ¸ì— ëŒ€í•œ ì„±ê³µ/ì‹¤íŒ¨ ì¼€ì´ìŠ¤
   - ì¸ì¦/ì¸ê°€ ê²€ì¦
   - ì…ë ¥ ê²€ì¦ ë° ì—ëŸ¬ í•¸ë“¤ë§
   - Rate limiting ë™ì‘ í™•ì¸

2. **ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§ (í•„ìˆ˜ ì»¤ë²„ë¦¬ì§€ 90%+)**
   - ì‹ í˜¸ ìƒì„± ì•Œê³ ë¦¬ì¦˜
   - í¬íŠ¸í´ë¦¬ì˜¤ ê³„ì‚° ë¡œì§
   - ë°±í…ŒìŠ¤íŒ… ì—”ì§„
   - ë¦¬ìŠ¤í¬ ê´€ë¦¬ í•¨ìˆ˜

3. **ë°ì´í„°ë² ì´ìŠ¤ ë ˆì´ì–´ (í•„ìˆ˜ ì»¤ë²„ë¦¬ì§€ 85%+)**
   - CRUD ì‘ì—… ê²€ì¦
   - íŠ¸ëœì­ì…˜ ì²˜ë¦¬
   - ë°ì´í„° ë¬´ê²°ì„± ì œì•½ì¡°ê±´
   - ë§ˆì´ê·¸ë ˆì´ì…˜ í…ŒìŠ¤íŠ¸

4. **ë³´ì•ˆ ì»´í¬ë„ŒíŠ¸ (í•„ìˆ˜ ì»¤ë²„ë¦¬ì§€ 95%+)**
   - ì¸ì¦/ì¸ê°€ ë¯¸ë“¤ì›¨ì–´
   - ì•”í˜¸í™”/ë³µí˜¸í™” í•¨ìˆ˜
   - ìƒŒë“œë°•ìŠ¤ ê²©ë¦¬
   - API í‚¤ ê²€ì¦

**ë‹¨ìœ„ í…ŒìŠ¤íŠ¸ ì‘ì„± ì˜ˆì‹œ:**

```javascript
// tests/api/logics.test.js
const request = require('supertest');
const app = require('../../src/app');
const db = require('../../src/db');

describe('Logic API', () => {
  beforeEach(async () => {
    await db.seed.run();
  });

  afterEach(async () => {
    await db.cleanupTestData();
  });

  describe('POST /api/v1/logics', () => {
    it('should create a new logic with valid data', async () => {
      const response = await request(app)
        .post('/api/v1/logics')
        .set('Authorization', 'Bearer valid-token')
        .send({
          name: 'Test Strategy',
          code: 'function generateSignal(input) { return "BUY"; }',
          description: 'Test description'
        });

      expect(response.status).toBe(201);
      expect(response.body.logic).toHaveProperty('id');
      expect(response.body.logic.name).toBe('Test Strategy');
    });

    it('should reject logic with malicious code', async () => {
      const response = await request(app)
        .post('/api/v1/logics')
        .set('Authorization', 'Bearer valid-token')
        .send({
          name: 'Malicious',
          code: 'require("child_process").exec("rm -rf /")'
        });

      expect(response.status).toBe(400);
      expect(response.body.error).toContain('Forbidden pattern');
    });

    it('should enforce authentication', async () => {
      const response = await request(app)
        .post('/api/v1/logics')
        .send({ name: 'Test' });

      expect(response.status).toBe(401);
    });
  });

  describe('GET /api/v1/logics', () => {
    it('should return paginated logic list', async () => {
      const response = await request(app)
        .get('/api/v1/logics?page=1&limit=10')
        .set('Authorization', 'Bearer valid-token');

      expect(response.status).toBe(200);
      expect(response.body).toHaveProperty('logics');
      expect(response.body).toHaveProperty('pagination');
      expect(response.body.pagination.page).toBe(1);
    });
  });
});

// tests/services/backtesting.test.js
const BacktestEngine = require('../../src/services/backtesting');

describe('Backtest Engine', () => {
  let engine;

  beforeEach(() => {
    engine = new BacktestEngine();
  });

  it('should calculate correct returns', () => {
    const trades = [
      { entry: 100, exit: 110, quantity: 1 },
      { entry: 110, exit: 105, quantity: 1 }
    ];

    const result = engine.calculateReturns(trades, 100);
    
    expect(result.totalReturn).toBeCloseTo(0.05); // 5%
    expect(result.winRate).toBe(0.5); // 50%
  });

  it('should handle empty trade list', () => {
    const result = engine.calculateReturns([], 100);
    
    expect(result.totalReturn).toBe(0);
    expect(result.trades).toBe(0);
  });

  it('should respect commission settings', () => {
    const trades = [{ entry: 100, exit: 110, quantity: 1 }];
    const commission = 0.001; // 0.1%

    const result = engine.calculateReturns(trades, 100, commission);
    
    // Return should be less than without commission
    expect(result.totalReturn).toBeLessThan(0.1);
  });
});
```

**í…ŒìŠ¤íŠ¸ ë””ë ‰í† ë¦¬ êµ¬ì¡°:**

```
project-root/
â”œâ”€â”€ src/
â”‚   â”œâ”€â”€ api/
â”‚   â”œâ”€â”€ services/
â”‚   â”œâ”€â”€ models/
â”‚   â””â”€â”€ utils/
â”œâ”€â”€ tests/
â”‚   â”œâ”€â”€ unit/
â”‚   â”‚   â”œâ”€â”€ api/
â”‚   â”‚   â”‚   â”œâ”€â”€ auth.test.js
â”‚   â”‚   â”‚   â”œâ”€â”€ logics.test.js
â”‚   â”‚   â”‚   â””â”€â”€ portfolios.test.js
â”‚   â”‚   â”œâ”€â”€ services/
â”‚   â”‚   â”‚   â”œâ”€â”€ backtesting.test.js
â”‚   â”‚   â”‚   â”œâ”€â”€ signal-generation.test.js
â”‚   â”‚   â”‚   â””â”€â”€ sandbox.test.js
â”‚   â”‚   â””â”€â”€ utils/
â”‚   â”‚       â”œâ”€â”€ validation.test.js
â”‚   â”‚       â””â”€â”€ encryption.test.js
â”‚   â”œâ”€â”€ integration/
â”‚   â”‚   â”œâ”€â”€ api-flow.test.js
â”‚   â”‚   â””â”€â”€ database.test.js
â”‚   â””â”€â”€ fixtures/
â”‚       â”œâ”€â”€ sample-logics.js
â”‚       â””â”€â”€ test-data.json
â””â”€â”€ jest.config.js
```

### ë¹Œë“œ ë° ë°°í¬ ë‹¨ìœ„ í…ŒìŠ¤íŠ¸ í•„ìˆ˜í™”

**CI/CD íŒŒì´í”„ë¼ì¸ í…ŒìŠ¤íŠ¸ ë‹¨ê³„:**

ëª¨ë“  ë¹Œë“œ ë° ë°°í¬ í”„ë¡œì„¸ìŠ¤ì—ì„œ ë‹¨ìœ„ í…ŒìŠ¤íŠ¸ í†µê³¼ê°€ í•„ìˆ˜ ì¡°ê±´ì…ë‹ˆë‹¤.

**GitHub Actions ì›Œí¬í”Œë¡œìš° ì˜ˆì‹œ:**

```yaml
# .github/workflows/ci-cd.yml
name: CI/CD Pipeline

on:
  push:
    branches: [main, develop]
  pull_request:
    branches: [main, develop]

jobs:
  test:
    name: Run Tests
    runs-on: ubuntu-latest
    
    services:
      postgres:
        image: postgres:15
        env:
          POSTGRES_PASSWORD: test
          POSTGRES_DB: signal_factory_test
        options: >-
          --health-cmd pg_isready
          --health-interval 10s
          --health-timeout 5s
          --health-retries 5
      
      redis:
        image: redis:7
        options: >-
          --health-cmd "redis-cli ping"
          --health-interval 10s
          --health-timeout 5s
          --health-retries 5

    steps:
      - name: Checkout code
        uses: actions/checkout@v3

      - name: Setup Node.js
        uses: actions/setup-node@v3
        with:
          node-version: '18'
          cache: 'npm'

      - name: Install dependencies
        run: npm ci

      - name: Run linter
        run: npm run lint

      - name: Run unit tests
        run: npm run test:unit
        env:
          DATABASE_URL: postgresql://postgres:test@localhost:5432/signal_factory_test
          REDIS_URL: redis://localhost:6379

      - name: Run integration tests
        run: npm run test:integration
        env:
          DATABASE_URL: postgresql://postgres:test@localhost:5432/signal_factory_test
          REDIS_URL: redis://localhost:6379

      - name: Generate coverage report
        run: npm run test:coverage

      - name: Check coverage thresholds
        run: |
          npm run test:coverage -- --coverageThreshold='{"global":{"branches":80,"functions":85,"lines":85,"statements":85}}'

      - name: Upload coverage to Codecov
        uses: codecov/codecov-action@v3
        with:
          file: ./coverage/coverage-final.json
          fail_ci_if_error: true

  build:
    name: Build Application
    needs: test  # í…ŒìŠ¤íŠ¸ í†µê³¼ í•„ìˆ˜
    runs-on: ubuntu-latest
    
    steps:
      - name: Checkout code
        uses: actions/checkout@v3

      - name: Setup Node.js
        uses: actions/setup-node@v3
        with:
          node-version: '18'
          cache: 'npm'

      - name: Install dependencies
        run: npm ci

      - name: Build
        run: npm run build

      - name: Build Docker image
        run: docker build -t signal-factory:${{ github.sha }} .

  deploy-staging:
    name: Deploy to Staging
    needs: build  # ë¹Œë“œ ì„±ê³µ í•„ìˆ˜
    runs-on: ubuntu-latest
    if: github.ref == 'refs/heads/develop'
    
    steps:
      - name: Deploy to staging
        run: |
          # ìŠ¤í…Œì´ì§• ë°°í¬ ìŠ¤í¬ë¦½íŠ¸
          echo "Deploying to staging..."

      - name: Run smoke tests
        run: npm run test:smoke -- --env=staging

  deploy-production:
    name: Deploy to Production
    needs: build
    runs-on: ubuntu-latest
    if: github.ref == 'refs/heads/main'
    
    steps:
      - name: Deploy to production
        run: |
          # í”„ë¡œë•ì…˜ ë°°í¬ ìŠ¤í¬ë¦½íŠ¸
          echo "Deploying to production..."

      - name: Run smoke tests
        run: npm run test:smoke -- --env=production

      - name: Notify deployment
        run: |
          # Slack ì•Œë¦¼ ë“±
          echo "Deployment completed"
```

**í…ŒìŠ¤íŠ¸ ì‹¤íŒ¨ ì‹œ ë°°í¬ ì°¨ë‹¨:**

```javascript
// jest.config.js
module.exports = {
  testEnvironment: 'node',
  coverageThreshold: {
    global: {
      branches: 80,
      functions: 85,
      lines: 85,
      statements: 85
    },
    './src/api/': {
      branches: 80,
      functions: 80,
      lines: 80,
      statements: 80
    },
    './src/services/': {
      branches: 90,
      functions: 90,
      lines: 90,
      statements: 90
    },
    './src/security/': {
      branches: 95,
      functions: 95,
      lines: 95,
      statements: 95
    }
  },
  collectCoverageFrom: [
    'src/**/*.{js,ts}',
    '!src/**/*.d.ts',
    '!src/**/index.{js,ts}',
    '!src/**/*.mock.{js,ts}'
  ],
  testMatch: [
    '**/tests/**/*.test.{js,ts}',
    '**/__tests__/**/*.{js,ts}'
  ]
};
```

**Pre-commit Hook:**

```bash
# .husky/pre-commit
#!/bin/sh
. "$(dirname "$0")/_/husky.sh"

echo "ğŸ§ª Running pre-commit tests..."

# Lint staged files
npm run lint-staged

# Run unit tests for changed files
npm run test:changed

if [ $? -ne 0 ]; then
  echo "âŒ Tests failed. Commit aborted."
  exit 1
fi

echo "âœ… All tests passed. Proceeding with commit."
```

**Package.json ìŠ¤í¬ë¦½íŠ¸:**

```json
{
  "scripts": {
    "test": "jest",
    "test:unit": "jest --testPathPattern=tests/unit",
    "test:integration": "jest --testPathPattern=tests/integration",
    "test:coverage": "jest --coverage",
    "test:changed": "jest --changedSince=HEAD --coverage",
    "test:watch": "jest --watch",
    "test:smoke": "jest --testPathPattern=tests/smoke",
    "lint": "eslint src tests --ext .js,.ts",
    "lint-staged": "lint-staged"
  }
}
```

### í”„ë¡ íŠ¸ì—”ë“œ ë‹¨ìœ„ í…ŒìŠ¤íŠ¸

**í…ŒìŠ¤íŠ¸ í”„ë ˆì„ì›Œí¬:**
- **Jest**: í…ŒìŠ¤íŠ¸ ëŸ¬ë„ˆ
- **React Testing Library**: React ì»´í¬ë„ŒíŠ¸ í…ŒìŠ¤íŠ¸
- **MSW (Mock Service Worker)**: API ëª¨í‚¹
- **jest-dom**: DOM ê²€ì¦ í™•ì¥
- **user-event**: ì‚¬ìš©ì ìƒí˜¸ì‘ìš© ì‹œë®¬ë ˆì´ì…˜

**í…ŒìŠ¤íŠ¸ ëŒ€ìƒ ë° ì ‘ê·¼ ë°©ë²•:**

1. **ì»´í¬ë„ŒíŠ¸ í…ŒìŠ¤íŠ¸**
   - ë Œë”ë§ ê²€ì¦
   - ì‚¬ìš©ì ìƒí˜¸ì‘ìš© (í´ë¦­, ì…ë ¥ ë“±)
   - ìƒíƒœ ë³€í™” í™•ì¸
   - ì¡°ê±´ë¶€ ë Œë”ë§

2. **ì»¤ìŠ¤í…€ í›… í…ŒìŠ¤íŠ¸**
   - ìƒíƒœ ê´€ë¦¬ ë¡œì§
   - ì‚¬ì´ë“œ ì´í™íŠ¸
   - ì˜ì¡´ì„± ë°°ì—´

3. **ìœ í‹¸ë¦¬í‹° í•¨ìˆ˜ í…ŒìŠ¤íŠ¸**
   - ìˆœìˆ˜ í•¨ìˆ˜ ê²€ì¦
   - ì—£ì§€ ì¼€ì´ìŠ¤ ì²˜ë¦¬
   - ë°ì´í„° ë³€í™˜ ë¡œì§

**í”„ë¡ íŠ¸ì—”ë“œ í…ŒìŠ¤íŠ¸ ì˜ˆì‹œ:**

```typescript
// tests/components/LogicEditor.test.tsx
import { render, screen, waitFor } from '@testing-library/react';
import userEvent from '@testing-library/user-event';
import { LogicEditor } from '@/components/LogicEditor';
import { QueryClient, QueryClientProvider } from '@tanstack/react-query';

const createWrapper = () => {
  const queryClient = new QueryClient({
    defaultOptions: {
      queries: { retry: false },
      mutations: { retry: false }
    }
  });

  return ({ children }: { children: React.ReactNode }) => (
    <QueryClientProvider client={queryClient}>
      {children}
    </QueryClientProvider>
  );
};

describe('LogicEditor', () => {
  it('should render editor with default code', () => {
    render(<LogicEditor />, { wrapper: createWrapper() });
    
    expect(screen.getByRole('textbox')).toBeInTheDocument();
    expect(screen.getByText(/function generateSignal/i)).toBeInTheDocument();
  });

  it('should update code on user input', async () => {
    const user = userEvent.setup();
    render(<LogicEditor />, { wrapper: createWrapper() });
    
    const editor = screen.getByRole('textbox');
    await user.clear(editor);
    await user.type(editor, 'const newCode = "test";');
    
    expect(editor).toHaveValue('const newCode = "test";');
  });

  it('should show validation errors for invalid code', async () => {
    const user = userEvent.setup();
    render(<LogicEditor />, { wrapper: createWrapper() });
    
    const editor = screen.getByRole('textbox');
    await user.clear(editor);
    await user.type(editor, 'require("fs")');
    
    await waitFor(() => {
      expect(screen.getByText(/forbidden pattern/i)).toBeInTheDocument();
    });
  });

  it('should save logic on save button click', async () => {
    const user = userEvent.setup();
    const onSave = jest.fn();
    
    render(<LogicEditor onSave={onSave} />, { wrapper: createWrapper() });
    
    const saveButton = screen.getByRole('button', { name: /save/i });
    await user.click(saveButton);
    
    expect(onSave).toHaveBeenCalled();
  });
});

// tests/components/BacktestResults.test.tsx
import { render, screen } from '@testing-library/react';
import { BacktestResults } from '@/components/BacktestResults';
import { server } from '@/mocks/server';
import { rest } from 'msw';

describe('BacktestResults', () => {
  it('should display loading state', () => {
    render(<BacktestResults backtestId="test-id" />);
    
    expect(screen.getByText(/loading/i)).toBeInTheDocument();
  });

  it('should display backtest results', async () => {
    render(<BacktestResults backtestId="test-id" />);
    
    await waitFor(() => {
      expect(screen.getByText(/total return/i)).toBeInTheDocument();
    });
    
    expect(screen.getByText(/15.0%/i)).toBeInTheDocument();
    expect(screen.getByText(/sharpe ratio/i)).toBeInTheDocument();
  });

  it('should handle error state', async () => {
    server.use(
      rest.get('/api/v1/backtests/:id', (req, res, ctx) => {
        return res(ctx.status(500), ctx.json({ error: 'Server error' }));
      })
    );

    render(<BacktestResults backtestId="test-id" />);
    
    await waitFor(() => {
      expect(screen.getByText(/error/i)).toBeInTheDocument();
    });
  });
});

// tests/hooks/useWebSocket.test.ts
import { renderHook, waitFor } from '@testing-library/react';
import { useWebSocket } from '@/hooks/useWebSocket';
import WS from 'jest-websocket-mock';

describe('useWebSocket', () => {
  let server: WS;

  beforeEach(() => {
    server = new WS('ws://localhost:1234/signals');
  });

  afterEach(() => {
    WS.clean();
  });

  it('should connect to WebSocket', async () => {
    const { result } = renderHook(() => 
      useWebSocket('ws://localhost:1234/signals')
    );

    await server.connected;
    
    expect(result.current.isConnected).toBe(true);
  });

  it('should receive messages', async () => {
    const { result } = renderHook(() => 
      useWebSocket('ws://localhost:1234/signals')
    );

    await server.connected;
    
    server.send(JSON.stringify({ type: 'SIGNAL', data: { action: 'BUY' } }));
    
    await waitFor(() => {
      expect(result.current.data).toEqual({ 
        type: 'SIGNAL', 
        data: { action: 'BUY' } 
      });
    });
  });
});

// tests/utils/formatters.test.ts
import { formatCurrency, formatPercent } from '@/utils/formatters';

describe('Formatters', () => {
  describe('formatCurrency', () => {
    it('should format positive numbers', () => {
      expect(formatCurrency(1234.56)).toBe('$1,234.56');
    });

    it('should format negative numbers', () => {
      expect(formatCurrency(-1234.56)).toBe('-$1,234.56');
    });

    it('should handle zero', () => {
      expect(formatCurrency(0)).toBe('$0.00');
    });
  });

  describe('formatPercent', () => {
    it('should format decimal as percentage', () => {
      expect(formatPercent(0.1234)).toBe('12.34%');
    });

    it('should handle negative percentages', () => {
      expect(formatPercent(-0.05)).toBe('-5.00%');
    });
  });
});
```

**MSW ì„¤ì • (API ëª¨í‚¹):**

```typescript
// src/mocks/handlers.ts
import { rest } from 'msw';

export const handlers = [
  rest.get('/api/v1/backtests/:id', (req, res, ctx) => {
    return res(
      ctx.json({
        backtest: {
          id: req.params.id,
          status: 'completed',
          summary: {
            totalReturn: 0.15,
            annualizedReturn: 0.18,
            sharpeRatio: 1.5,
            maxDrawdown: 0.08
          }
        }
      })
    );
  }),

  rest.get('/api/v1/logics', (req, res, ctx) => {
    return res(
      ctx.json({
        logics: [
          { id: '1', name: 'Strategy 1', createdAt: '2025-01-01' },
          { id: '2', name: 'Strategy 2', createdAt: '2025-01-02' }
        ],
        pagination: { page: 1, total: 2 }
      })
    );
  })
];

// src/mocks/server.ts
import { setupServer } from 'msw/node';
import { handlers } from './handlers';

export const server = setupServer(...handlers);

// tests/setup.ts
import '@testing-library/jest-dom';
import { server } from '@/mocks/server';

beforeAll(() => server.listen());
afterEach(() => server.resetHandlers());
afterAll(() => server.close());
```

**E2E í…ŒìŠ¤íŠ¸ (Playwright):**

```typescript
// e2e/logic-workflow.spec.ts
import { test, expect } from '@playwright/test';

test.describe('Logic Creation Workflow', () => {
  test('should create a new logic end-to-end', async ({ page }) => {
    // ë¡œê·¸ì¸
    await page.goto('/login');
    await page.fill('[name="email"]', 'test@example.com');
    await page.fill('[name="password"]', 'password');
    await page.click('button[type="submit"]');

    // ë¡œì§ í˜ì´ì§€ë¡œ ì´ë™
    await page.goto('/logics/new');

    // ë¡œì§ ì‘ì„±
    await page.fill('[name="name"]', 'Test Strategy');
    await page.fill('[name="description"]', 'E2E test strategy');
    
    const editor = page.locator('.monaco-editor');
    await editor.click();
    await page.keyboard.type('function generateSignal(input) { return "BUY"; }');

    // ì €ì¥
    await page.click('button:has-text("Save")');

    // ì„±ê³µ ë©”ì‹œì§€ í™•ì¸
    await expect(page.locator('.success-message')).toBeVisible();
    
    // ë¦¬ìŠ¤íŠ¸ì—ì„œ í™•ì¸
    await page.goto('/logics');
    await expect(page.locator('text=Test Strategy')).toBeVisible();
  });
});
```

### ì™¸ë¶€ API ë…ë¦½ ì‚¬ìš©ì„ ìœ„í•œ í† í° ë°œí–‰

**API í† í° ì¸ì¦ ì‹œìŠ¤í…œ:**

Signal Factory APIë¥¼ ì™¸ë¶€ ì• í”Œë¦¬ì¼€ì´ì…˜ì—ì„œ ë…ë¦½ì ìœ¼ë¡œ ì‚¬ìš©í•˜ê¸° ìœ„í•œ í† í° ê¸°ë°˜ ì¸ì¦ ì‹œìŠ¤í…œì„ ì œê³µí•©ë‹ˆë‹¤.

**í† í° ìœ í˜•:**

1. **ê°œì¸ ì•¡ì„¸ìŠ¤ í† í° (Personal Access Token)**
   - ì‚¬ìš©ì ê³„ì •ì— ì—°ê²°ëœ ì¥ê¸° í† í°
   - íŠ¹ì • ìŠ¤ì½”í”„ì™€ ê¶Œí•œ ì„¤ì • ê°€ëŠ¥
   - ë§Œë£Œ ê¸°ê°„ ì„¤ì • ê°€ëŠ¥ (30ì¼, 90ì¼, 1ë…„, ë¬´ì œí•œ)

2. **ì„œë¹„ìŠ¤ ê³„ì • í† í° (Service Account Token)**
   - íŠ¹ì • ì„œë¹„ìŠ¤/ì• í”Œë¦¬ì¼€ì´ì…˜ìš© í† í°
   - ì‚¬ìš©ì ê³„ì •ê³¼ ë…ë¦½ì 
   - ì—”í„°í”„ë¼ì´ì¦ˆ í‹°ì–´ ì „ìš©

3. **ì„ì‹œ í† í° (Temporary Token)**
   - ë‹¨ê¸°ê°„ ì‚¬ìš©ì„ ìœ„í•œ í† í°
   - ì œí•œëœ ìŠ¤ì½”í”„
   - 24ì‹œê°„ í›„ ìë™ ë§Œë£Œ

**í† í° ë°œí–‰ í”„ë¡œì„¸ìŠ¤:**

**1. ì›¹ UIë¥¼ í†µí•œ í† í° ìƒì„±:**

```
ì‚¬ìš©ì ë¡œê·¸ì¸ â†’ ì„¤ì • â†’ API í† í° â†’ ìƒˆ í† í° ìƒì„±
```

**í† í° ìƒì„± í™”ë©´ êµ¬ì„±:**
- í† í° ì´ë¦„/ì„¤ëª… ì…ë ¥
- ê¶Œí•œ ìŠ¤ì½”í”„ ì„ íƒ (read:logics, write:logics, read:signals, execute:backtests ë“±)
- ë§Œë£Œ ê¸°ê°„ ì„¤ì •
- IP í™”ì´íŠ¸ë¦¬ìŠ¤íŠ¸ (ì„ íƒì‚¬í•­)

**2. APIë¥¼ í†µí•œ í† í° ìƒì„±:**

```bash
# í† í° ìƒì„±
POST /api/v1/tokens
Authorization: Bearer <existing-jwt-token>
Content-Type: application/json

{
  "name": "My External App Token",
  "description": "Token for automated trading bot",
  "scopes": ["read:signals", "write:orders"],
  "expiresIn": "90d",
  "ipWhitelist": ["203.0.113.0/24"]
}

# Response
{
  "token": {
    "id": "token_abc123xyz",
    "token": "sfact_1a2b3c4d5e6f7g8h9i0j", 
    "name": "My External App Token",
    "scopes": ["read:signals", "write:orders"],
    "createdAt": "2025-01-15T10:00:00Z",
    "expiresAt": "2025-04-15T10:00:00Z"
  }
}
```

âš ï¸ **ì¤‘ìš”**: í† í°ì€ ìƒì„± ì‹œ ë‹¨ í•œ ë²ˆë§Œ í‘œì‹œë˜ë©°, ì´í›„ ì¡°íšŒ ë¶ˆê°€ëŠ¥í•©ë‹ˆë‹¤. ì•ˆì „í•œ ê³³ì— ë³´ê´€í•˜ì„¸ìš”.

**3. í† í° ê´€ë¦¬ API:**

```bash
# í† í° ëª©ë¡ ì¡°íšŒ
GET /api/v1/tokens
Authorization: Bearer <jwt-token>

# Response
{
  "tokens": [
    {
      "id": "token_abc123xyz",
      "name": "My External App Token",
      "scopes": ["read:signals", "write:orders"],
      "lastUsed": "2025-01-14T15:30:00Z",
      "createdAt": "2025-01-15T10:00:00Z",
      "expiresAt": "2025-04-15T10:00:00Z"
    }
  ]
}

# í† í° ìƒì„¸ ì¡°íšŒ
GET /api/v1/tokens/:tokenId
Authorization: Bearer <jwt-token>

# í† í° íê¸°
DELETE /api/v1/tokens/:tokenId
Authorization: Bearer <jwt-token>

# í† í° ìŠ¤ì½”í”„ ì—…ë°ì´íŠ¸
PATCH /api/v1/tokens/:tokenId
Authorization: Bearer <jwt-token>
Content-Type: application/json

{
  "scopes": ["read:signals", "read:logics"]
}
```

**í† í° ì‚¬ìš© ì˜ˆì‹œ:**

```bash
# HTTP Headerë¥¼ í†µí•œ ì¸ì¦
curl -X GET https://api.signal-factory.com/api/v1/signals/realtime \
  -H "Authorization: Bearer sfact_1a2b3c4d5e6f7g8h9i0j" \
  -H "Content-Type: application/json"

# Python ì˜ˆì‹œ
import requests

API_TOKEN = "sfact_1a2b3c4d5e6f7g8h9i0j"
BASE_URL = "https://api.signal-factory.com/api/v1"

headers = {
    "Authorization": f"Bearer {API_TOKEN}",
    "Content-Type": "application/json"
}

# ì‹¤ì‹œê°„ ì‹ í˜¸ ì¡°íšŒ
response = requests.get(
    f"{BASE_URL}/signals/realtime",
    headers=headers,
    params={"portfolioId": "portfolio-123"}
)

signals = response.json()

# JavaScript/Node.js ì˜ˆì‹œ
const axios = require('axios');

const API_TOKEN = 'sfact_1a2b3c4d5e6f7g8h9i0j';
const BASE_URL = 'https://api.signal-factory.com/api/v1';

const client = axios.create({
  baseURL: BASE_URL,
  headers: {
    'Authorization': `Bearer ${API_TOKEN}`
  }
});

// ë°±í…ŒìŠ¤íŠ¸ ì‹¤í–‰
async function runBacktest() {
  const response = await client.post('/backtests', {
    portfolioId: 'portfolio-123',
    startDate: '2024-01-01',
    endDate: '2024-12-31',
    initialCash: 10000
  });
  
  return response.data;
}
```

**í† í° ìŠ¤ì½”í”„ ì •ì˜:**

| ìŠ¤ì½”í”„ | ì„¤ëª… | í—ˆìš© ì‘ì—… |
|-------|------|----------|
| `read:logics` | ë¡œì§ ì½ê¸° | GET /logics, GET /logics/:id |
| `write:logics` | ë¡œì§ ìƒì„±/ìˆ˜ì • | POST /logics, PUT /logics/:id, DELETE /logics/:id |
| `read:portfolios` | í¬íŠ¸í´ë¦¬ì˜¤ ì½ê¸° | GET /portfolios, GET /portfolios/:id |
| `write:portfolios` | í¬íŠ¸í´ë¦¬ì˜¤ ìƒì„±/ìˆ˜ì • | POST /portfolios, PUT /portfolios/:id |
| `execute:backtests` | ë°±í…ŒìŠ¤íŠ¸ ì‹¤í–‰ | POST /backtests, GET /backtests/:id |
| `read:signals` | ì‹¤ì‹œê°„ ì‹ í˜¸ ì¡°íšŒ | GET /signals/realtime, WebSocket ì—°ê²° |
| `write:orders` | ì£¼ë¬¸ ì‹¤í–‰ (ì—”í„°í”„ë¼ì´ì¦ˆ) | POST /orders, DELETE /orders/:id |
| `admin` | ê´€ë¦¬ì ê¶Œí•œ | ëª¨ë“  API ì ‘ê·¼ |

**ë³´ì•ˆ ê³ ë ¤ì‚¬í•­:**

1. **í† í° ì €ì¥:**
   - ë°ì´í„°ë² ì´ìŠ¤ì—ëŠ” í•´ì‹œëœ í˜•íƒœë¡œë§Œ ì €ì¥
   - bcryptë¥¼ ì‚¬ìš©í•œ ë‹¨ë°©í–¥ í•´ì‹±
   - ì›ë³¸ í† í°ì€ ìƒì„± ì‹œì ì—ë§Œ ë…¸ì¶œ

2. **í† í° ê²€ì¦:**
   - ìš”ì²­ë§ˆë‹¤ í† í° ìœ íš¨ì„± ê²€ì¦
   - ë§Œë£Œ ì‹œê°„ í™•ì¸
   - IP í™”ì´íŠ¸ë¦¬ìŠ¤íŠ¸ ê²€ì¦ (ì„¤ì •ëœ ê²½ìš°)
   - Rate limiting ì ìš©

3. **ê°ì‚¬ ë¡œê¹…:**
   - ëª¨ë“  í† í° ì‚¬ìš© ê¸°ë¡
   - ë¹„ì •ìƒì ì¸ ì‚¬ìš© íŒ¨í„´ ê°ì§€
   - í† í° ìƒì„±/íê¸° ì´ë ¥ ë³´ê´€

**í† í° êµ¬í˜„ ì˜ˆì‹œ:**

```javascript
// src/services/tokenService.js
const crypto = require('crypto');
const bcrypt = require('bcrypt');
const db = require('../db');

class TokenService {
  async createToken(userId, options) {
    // í† í° ìƒì„± (ì ‘ë‘ì‚¬ + ëœë¤ ë¬¸ìì—´)
    const randomBytes = crypto.randomBytes(32).toString('hex');
    const token = `sfact_${randomBytes}`;
    
    // í† í° í•´ì‹±
    const hash = await bcrypt.hash(token, 10);
    
    // DBì— ì €ì¥
    const record = await db.tokens.create({
      userId,
      tokenHash: hash,
      name: options.name,
      description: options.description,
      scopes: options.scopes,
      expiresAt: this.calculateExpiry(options.expiresIn),
      ipWhitelist: options.ipWhitelist || null
    });
    
    // ì›ë³¸ í† í°ì€ í•œ ë²ˆë§Œ ë°˜í™˜
    return { ...record, token };
  }
  
  async validateToken(token, requiredScopes = []) {
    // ëª¨ë“  í™œì„± í† í° ì¡°íšŒ
    const tokens = await db.tokens.findActive();
    
    for (const record of tokens) {
      // í† í° ë§¤ì¹­ í™•ì¸
      const valid = await bcrypt.compare(token, record.tokenHash);
      
      if (valid) {
        // ë§Œë£Œ í™•ì¸
        if (record.expiresAt && new Date() > record.expiresAt) {
          throw new Error('Token expired');
        }
        
        // ìŠ¤ì½”í”„ í™•ì¸
        if (!this.hasRequiredScopes(record.scopes, requiredScopes)) {
          throw new Error('Insufficient scopes');
        }
        
        // ë§ˆì§€ë§‰ ì‚¬ìš© ì‹œê°„ ì—…ë°ì´íŠ¸
        await db.tokens.updateLastUsed(record.id);
        
        return record;
      }
    }
    
    throw new Error('Invalid token');
  }
  
  hasRequiredScopes(tokenScopes, requiredScopes) {
    if (tokenScopes.includes('admin')) return true;
    return requiredScopes.every(scope => tokenScopes.includes(scope));
  }
  
  calculateExpiry(expiresIn) {
    if (!expiresIn) return null;
    
    const units = {
      'd': 24 * 60 * 60 * 1000,
      'w': 7 * 24 * 60 * 60 * 1000,
      'm': 30 * 24 * 60 * 60 * 1000,
      'y': 365 * 24 * 60 * 60 * 1000
    };
    
    const match = expiresIn.match(/^(\d+)([dwmy])$/);
    if (!match) throw new Error('Invalid expiry format');
    
    const [, amount, unit] = match;
    return new Date(Date.now() + parseInt(amount) * units[unit]);
  }
  
  async revokeToken(tokenId, userId) {
    return db.tokens.update(tokenId, {
      revokedAt: new Date(),
      revokedBy: userId
    });
  }
}

// Express ë¯¸ë“¤ì›¨ì–´
function authenticateToken(requiredScopes = []) {
  return async (req, res, next) => {
    const authHeader = req.headers.authorization;
    const token = authHeader?.replace('Bearer ', '');
    
    if (!token) {
      return res.status(401).json({ error: 'No token provided' });
    }
    
    try {
      const tokenRecord = await tokenService.validateToken(token, requiredScopes);
      
      // IP í™”ì´íŠ¸ë¦¬ìŠ¤íŠ¸ í™•ì¸
      if (tokenRecord.ipWhitelist && tokenRecord.ipWhitelist.length > 0) {
        const clientIp = req.ip;
        if (!this.isIpAllowed(clientIp, tokenRecord.ipWhitelist)) {
          return res.status(403).json({ error: 'IP not allowed' });
        }
      }
      
      req.tokenAuth = {
        userId: tokenRecord.userId,
        tokenId: tokenRecord.id,
        scopes: tokenRecord.scopes
      };
      
      next();
    } catch (error) {
      return res.status(401).json({ error: error.message });
    }
  };
}

// ì‚¬ìš© ì˜ˆ
app.get('/api/v1/signals/realtime',
  authenticateToken(['read:signals']),
  async (req, res) => {
    // í† í° ì¸ì¦ëœ ìš”ì²­ ì²˜ë¦¬
  }
);
```

**Rate Limiting (í† í°ë³„):**

```javascript
class TokenRateLimiter {
  async checkLimit(tokenId, tier) {
    const limits = {
      free: { requests: 100, window: 3600000 }, // 100/hour
      premium: { requests: 1000, window: 3600000 }, // 1000/hour
      enterprise: { requests: -1, window: 0 } // unlimited
    };
    
    const limit = limits[tier];
    if (limit.requests === -1) return; // unlimited
    
    const key = `ratelimit:token:${tokenId}`;
    const count = await redis.incr(key);
    
    if (count === 1) {
      await redis.expire(key, Math.ceil(limit.window / 1000));
    }
    
    if (count > limit.requests) {
      throw new Error('Rate limit exceeded');
    }
  }
}
```

## ì°¸ì¡° ë¬¸ì„œ ëª©ë¡

1. [ì•„í‚¤í…ì²˜ ê°œìš”](./01_architecture_overview.md)
2. [ë°ì´í„° íŒŒì´í”„ë¼ì¸](./02_data_pipeline.md)
3. [ì‹ í˜¸ ìƒì„± ì‹œìŠ¤í…œ](./03_signal_generation.md)
4. [ì‹¤í–‰ ì—”ì§„](./04_execution_engine.md)
5. [ì›¹ UI](./05_web_ui.md)
6. [ëª¨ë°”ì¼ ì•±](./06_mobile_app.md)
7. [ë³´ì•ˆ](./07_security.md)
8. [ë°°í¬ ë° ìš´ì˜](./08_deployment.md)
9. [API ëª…ì„¸](./09_api_specifications.md)
10. [ë°ì´í„° ëª¨ë¸](./10_data_models.md)
11. [ê¸°ìˆ  ìŠ¤íƒ](./11_tech_stack.md) - í…ŒìŠ¤íŠ¸ í”„ë ˆì„ì›Œí¬ í¬í•¨
12. [ì‚¬ìš©ì ì›Œí¬í”Œë¡œìš°](./12_user_workflows.md)
13. [ë¹„ì¦ˆë‹ˆìŠ¤ ëª¨ë¸](./13_business_model.md)
14. [ê°œë°œ ë¡œë“œë§µ](./14_roadmap.md)

## ë¬¸ì„œ ìƒì„± ì •ë³´

- **ìƒì„±ì¼**: 2025-11-03
- **ë²„ì „**: 1.0.0
- **ì‘ì„± ê·¼ê±°**: PROJECT_PLAN.md ì „ì²´ ë¶„ì„
- **ëª©ì **: ê³„ì¸µì  êµ¬ì¡°ì˜ ìƒì„¸ ê¸°íš ë¬¸ì„œ ì²´ê³„ êµ¬ì¶•
