# 프로젝트 기획서 초안

프로젝트명: signal-factory

개요
- 시계열(시간순) 데이터 입력을 받아 주어진 로직에 따라 매매 진입(Entry) / 청산(Exit) 신호를 생성하고, 생성된 신호에 따라 가상 및 실제 거래를 수행하는 프레임워크를 구축한다.

핵심 목표
- 유연한 트레이딩 로직 적용: 사용자 정의 로직(데이터베이스 DML 또는 JavaScript 라이브러리 형태)을 손쉽게 추가/교체 가능
- 시뮬레이션과 실거래 분리: 동일한 신호를 가상 시뮬레이션으로 검증한 후 실제 거래 연결
- 보안·격리: 외부 시스템과 로직 실행을 분리하여 보안 문제를 해소
- 테스트·재현성: 백테스트와 포워드 테스트가 가능하도록 데이터와 로직의 버전 관리

주요 기능
1) 데이터 입력
- 입력 포맷: CSV, Parquet, JSONL, 혹은 스트리밍(예: Kafka) 지원
- 타임스탬프, OHLCV(시가/고가/저가/종가/거래량) 표준 컬럼 권장
- 전처리: 결측치 처리, 리샘플링, 타임존 표준화

1-1) 시세 데이터 공급 지원 컴포넌트
- 여러 시장에 대응 가능하도록 아래와 같이 추상화하여 구성
  - 데이터 수집기 (Data Collector)
    - 다양한 데이터 소스로부터 시계열 데이터를 수집
    - 거래소 API, 데이터 제공업체, CSV 파일 등 다양한 소스 지원
    - 수집 스케줄링 및 재시도 메커니즘 제공
    - 데이터 품질 검증 및 이상치 탐지
  - 시세 발생기 (Price Generator)
    - 수집된 원시 데이터를 표준 시세 포맷으로 변환
    - OHLCV 데이터 생성 및 정규화
    - 다양한 시간 단위(틱, 1분, 5분, 1시간 등) 지원
    - 시장별 특성을 고려한 데이터 보정
  - 실시간 시세 변환기 (Real-time Price Converter)
    - 실시간 데이터 스트림을 내부 표준 포맷으로 변환
    - WebSocket, REST API, 메시지 큐 등 다양한 프로토콜 지원
    - 시장별 데이터 형식 차이를 추상화
    - 지연시간 최소화 및 데이터 무결성 보장

2) 신호 생성 로직
- 로직 인터페이스: 명확한 입력(타임시리즈 스냅샷), 출력(ENTRY/EXIT/NOOP, 포지션 사이즈, 메타데이터) 규격 정의
- 로직 제공 방식: SQL/DML(예: 저장 프로시저) 또는 JavaScript(또는 TypeScript) 라이브러리 형태로 로직 제공
- 로직은 단일 책임 원칙을 따르도록 권장

2-1) 사용자 로직 관리 (CRUD)
- 사용자가 직접 로직을 작성/수정/조회/삭제할 수 있음
- 로직은 JavaScript로 작성되며, 표준 ECMAScript 문법 지원
- 웹 UI를 통한 로직 CRUD 기능 제공
  - 로직 작성: 코드 에디터(예: Monaco Editor, CodeMirror) 통합, 실시간 문법 검사
  - 로직 수정: 버전 관리 지원, 이전 버전으로 롤백 가능
  - 로직 조회: 저장된 로직 목록 조회, 검색 및 필터링 기능
  - 로직 삭제: 소프트 삭제 지원, 사용 중인 로직은 삭제 제한
- 로직 메타데이터 관리
  - 로직명, 설명, 작성자, 생성일시, 수정일시
  - 태그 및 카테고리 분류
  - 로직 성능 지표(백테스트 결과 연계)

2-2) 로직 실행 보안 및 격리
- 로직 실행은 외부 시스템과 완전히 격리되어 보안 문제 방지
- 샌드박스 환경에서 JavaScript 실행 (예: VM2, isolated-vm, QuickJS)
- 실행 제약 사항
  - 네트워크 접근 차단: HTTP, WebSocket 등 외부 통신 불가
  - 파일시스템 접근 차단: 로컬 파일 읽기/쓰기 불가
  - 프로세스 생성 차단: child_process, worker_threads 사용 불가
  - 실행 시간 제한: 타임아웃 설정으로 무한 루프 방지
  - 메모리 사용 제한: 최대 메모리 할당량 설정
- 허용된 기능
  - 순수 계산 로직: 수학 연산, 데이터 변환, 조건 판단
  - 제공된 라이브러리: 기술적 지표 계산 라이브러리(예: TA-Lib, Tulip Indicators)
  - 입력 데이터 접근: 전달된 시계열 데이터 및 포지션 정보

2-3) 로직 입출력 구조
- 입력 데이터 포맷 (JSON 객체)
  - 타입 1: 시계열 틱 데이터
    ```json
    [
      {
        "symbol": "AAPL",
        "tickData": [
          {"timestamp": "2024-01-01T09:30:00Z", "open": 150.0, "high": 151.0, "low": 149.5, "close": 150.5, "volume": 1000000},
          {"timestamp": "2024-01-01T09:31:00Z", "open": 150.5, "high": 151.5, "low": 150.0, "close": 151.0, "volume": 1100000}
        ]
      }
    ]
    ```
  - 타입 2: 현재 포지션 정보
    ```json
    [
      {
        "symbol": "AAPL",
        "positions": [
          {"entryPrice": 150.0, "quantity": 100}
        ]
      }
    ]
    ```
- 출력 데이터 포맷 (JSON 객체)
  ```json
  {
    "signals": [
      {
        "symbol": "AAPL",
        "action": "ENTRY",
        "orderType": "MARKET",
        "quantity": 100,
        "price": 151.0,
        "reason": "이동평균선 골든크로스",
        "metadata": {
          "confidence": 0.85,
          "indicators": {"ma20": 149.5, "ma50": 148.0}
        }
      },
      {
        "symbol": "TSLA",
        "action": "EXIT",
        "orderType": "LIMIT",
        "quantity": 50,
        "price": 200.0,
        "reason": "목표가 도달"
      }
    ]
  }
  ```
- 신호 액션 타입: ENTRY(진입), EXIT(청산), NONE(대기)
- 주문 타입: MARKET(시장가), LIMIT(지정가), STOP(손절), STOP_LIMIT(손절지정가)

3) 로직 포트폴리오
- 사용자는 본인이 작성한 여러 로직을 조합하여 로직 포트폴리오를 구성 가능
- 포트폴리오 구성 요소
  - 로직 선택: 등록된 로직 중 여러 개를 선택하여 포트폴리오에 추가
  - 가중치 설정: 각 로직의 신호에 대한 가중치 또는 우선순위 설정
  - 자금 배분: 각 로직에 할당할 자금 비율 설정
  - 신호 통합 전략
    - 다수결(Majority Vote): 여러 로직의 신호 중 과반수 결정 채택
    - 가중 평균(Weighted Average): 가중치를 적용한 평균 신호 계산
    - 우선순위(Priority): 특정 로직의 신호를 우선 적용
    - AND/OR 조합: 모든 로직 동의 또는 하나 이상 동의 조건
- 포트폴리오 메타데이터
  - 포트폴리오명, 설명, 구성 로직 목록
  - 생성일시, 수정일시, 마지막 실행일시
  - 상태: 활성(Active), 비활성(Inactive), 테스트(Testing)

3-1) 백테스팅 기능
- 로직 포트폴리오는 저장되어 있는 과거 시계열 데이터를 이용하여 성능 백테스팅 가능
- 백테스트 설정
  - 테스트 기간: 시작일, 종료일 설정
  - 초기 자금: 시뮬레이션 시작 시 가용 자금
  - 수수료 모델: 거래당 수수료율 또는 고정 수수료
  - 슬리피지 모델: 시장가 주문 시 예상 슬리피지
  - 대상 종목: 백테스트에 포함할 종목 목록
- 백테스트 실행 프로세스
  1. 과거 데이터를 시간 순서대로 로딩
  2. 각 타임스텝마다 포트폴리오 로직 실행
  3. 생성된 신호에 따라 가상 주문 생성 및 체결
  4. 포지션 관리 및 손익 계산
  5. 성과 지표 집계
- 백테스트 결과 리포트
  - 수익률 지표: 총 수익률, 연환산 수익률, 월별 수익률
  - 리스크 지표: 최대 낙폭(MDD), 변동성(Volatility), 샤프 비율(Sharpe Ratio), 소르티노 비율
  - 거래 통계: 총 거래 횟수, 승률, 평균 수익/손실, 최대 연속 승/패
  - 그래프: 자산 곡선, 낙폭 곡선, 월별 수익률 히트맵
  - 거래 내역: 개별 거래 상세 로그 (진입/청산 시점, 가격, 수량, 손익)

3-2) 실시간 신호 생성
- 로직 포트폴리오는 실시간 시계열 데이터를 이용하여 실시간 매매 신호 생성 가능
- 실시간 데이터 수신
  - 데이터 소스 연결: WebSocket, REST API, 메시지 큐(Kafka, Redis Streams)
  - 지원 데이터 타입: 틱 데이터, 1분봉, 5분봉 등 다양한 시간 단위
  - 데이터 정규화: 타임존 통일, 결측치 처리, 이상치 필터링
- 신호 생성 프로세스
  1. 실시간 데이터 스트림 구독
  2. 새로운 데이터 도착 시 포트폴리오 로직 트리거
  3. 현재 포지션 정보와 함께 로직 실행
  4. 생성된 신호를 신호 큐에 전달
  5. 신호 로깅 및 알림 발송
- 실시간 모니터링
  - 대시보드: 현재 포지션, 미실현 손익, 최근 신호 현황
  - 실시간 차트: 가격 차트 + 신호 발생 지점 표시
  - 성과 추적: 실시간 수익률, 일간/주간/월간 성과

3-3) 자동 매매
- 로직 포트폴리오는 실시간 매매 신호를 이용하여 자동 매매 가능
- 브로커 연동
  - 브로커 어댑터 인터페이스: 다양한 브로커 API 통합 지원
  - 지원 브로커: 증권사 API, 암호화폐 거래소 API (Binance, Upbit 등)
  - 인증 관리: API 키, 시크릿 키 안전한 저장 및 관리
- 자동 매매 실행 흐름
  1. 신호 큐에서 매매 신호 수신
  2. 리스크 검증
     - 최대 손실 한도 체크
     - 포지션 크기 제한 체크
     - 일일 거래 횟수 제한 체크
  3. 주문 생성 및 브로커 API 호출
  4. 주문 체결 확인 및 포지션 업데이트
  5. 거래 내역 로깅
- 안전 장치
  - 킬 스위치(Kill Switch): 긴급 정지 기능, 모든 포지션 즉시 청산
  - 손실 한도(Loss Limit): 일일/주간/월간 최대 손실액 설정, 초과 시 자동 정지
  - 수동 승인 모드: 중요한 거래는 사용자 승인 후 실행
  - 페이퍼 트레이딩: 실제 거래 전 가상 거래로 검증
- 거래 알림
  - 주문 체결 알림: 이메일, SMS, 슬랙, 텔레그램
  - 이상 상황 알림: 주문 실패, 과도한 손실, API 연결 끊김

4) 트레이딩 엔진
- 시뮬레이터: 과거 데이터로 가상 주문을 생성하고 PnL·슬리피지·수수료 등을 계산
- 브로커 어댑터: 실제 거래를 위해 외부 거래소/브로커 API와 연동(추상화 계층 제공)
- 주문 유형: 시장가, 지정가, IOC 등 기본 주문 지원

5) 웹 UI
- 로직 작성/수정/조회/삭제는 웹 UI를 통해 가능
- UI 구성 요소
  - 로직 에디터 페이지
    - 코드 에디터: 구문 강조, 자동 완성, 에러 표시
    - 실시간 문법 검사 및 린트
    - 로직 테스트 실행: 샘플 데이터로 즉시 테스트
    - 저장, 버전 관리, 롤백 기능
  - 로직 목록 페이지
    - 저장된 로직 목록 표시 (카드 또는 테이블 뷰)
    - 검색 및 필터링 (로직명, 태그, 작성자, 날짜)
    - 정렬 (생성일, 수정일, 이름, 성능)
    - 로직 삭제, 복제, 공유 기능
  - 포트폴리오 관리 페이지
    - 포트폴리오 생성/편집
    - 로직 선택 및 가중치 설정 UI
    - 드래그 앤 드롭으로 로직 조합
    - 백테스트 실행 버튼 및 결과 조회
    - 포트폴리오 구성을 지원하는 웹기반 GUI 제공
      - 직관적인 인터페이스로 포트폴리오 구성 요소 관리
      - 실시간 포트폴리오 성과 모니터링
      - 포트폴리오 비교 및 분석 도구
  - 백테스트 결과 페이지
    - 성과 지표 대시보드
    - 인터랙티브 차트 (자산 곡선, 낙폭 곡선)
    - 거래 내역 테이블 (필터링, 정렬, 엑스포트)
    - 리포트 다운로드 (PDF, CSV)
  - 실시간 모니터링 대시보드
    - 현재 포지션 현황
    - 실시간 손익 그래프
    - 최근 신호 목록
    - 시장 데이터 실시간 차트
  - 시세와 신호 차트
    - 시세 위에 신호 발생 시점 표시
      - 진입(ENTRY) 신호: 상향 화살표 또는 마커로 표시
      - 청산(EXIT) 신호: 하향 화살표 또는 마커로 표시
      - 신호 클릭 시 상세 정보 표시 (가격, 시간, 사유)
    - 모바일 대응
      - 반응형 디자인으로 다양한 화면 크기 지원
      - 터치 제스처 지원 (핀치 줌, 스와이프 스크롤)
      - 모바일 최적화 UI/UX
    - 캔버스로 작성
      - HTML5 Canvas 기반 고성능 렌더링
      - 대량의 데이터 포인트를 부드럽게 표시
      - 실시간 업데이트 및 애니메이션 지원
      - 커스터마이징 가능한 차트 스타일
  - 자동 매매 설정 페이지
    - 브로커 연동 설정
    - 리스크 관리 파라미터 설정
    - 킬 스위치 및 안전 장치 제어
    - 거래 내역 및 로그 조회
- 기술 스택 제안
  - 프론트엔드: React, Vue.js, 또는 Svelte
  - 코드 에디터: Monaco Editor (VS Code), CodeMirror
  - 차트 라이브러리: Chart.js, D3.js, Recharts, TradingView Lightweight Charts
  - UI 컴포넌트: Material-UI, Ant Design, Tailwind CSS
  - 상태 관리: Redux, Zustand, Pinia
  - API 통신: REST API 또는 GraphQL

6) 보안 및 격리
- 로직 실행 격리: 컨테이너(예: Firecracker, gVisor) 또는 프로세스 격리를 통해 사용자 로직을 실행
- 네트워크/파일시스템 제한: 실행 환경에 최소 권한만 부여
- 서명된 패키지만 허용 또는 샌드박스 검증 파이프라인 도입

7) 운영·모니터링
- 로깅: 신호 발생 로그, 주문 로그, 에러 로그 분리 저장
- 지표: 수익률, 최대 낙폭, 샤프비율 등 백테스트 리포트 자동 생성
- 알림: 주요 에러·거래 이상 발생 시 알림(예: Slack, Email)

8) 개발 경험
- 로컬 개발용 시뮬레이터 및 샘플 데이터 제공
- 로직 개발용 템플릿(DML 예제, JavaScript 예제) 제공
- CI: lint, format, 테스트(유닛/통합/백테스트) 자동화

데이터·로직 인터페이스 예시
- 입력: [{timestamp: ISO, open, high, low, close, volume, ...context}]
- 출력: {signal: "ENTRY"|"EXIT"|"NONE", size: number, reason?: string, metadata?: {...}}

초기 기술 스택 제안
- 언어: Node.js(Logic SDK), Python(백테스트·데이터 처리), TypeScript 권장
- 저장소: Postgres(메타데이터), S3(원시·백테스트 데이터), Redis(실시간 상태)
- 컨테이너: Docker, 리소스 격리를 위한 추가 솔루션 권장
- CI: GitHub Actions

로드맵(단계별)
1. 초기 설계 및 프로젝트 구조화(이번 스텝)
2. 데이터 입력 파이프라인과 샘플 데이터 준비
3. 로직 인터페이스와 샘플 JavaScript 템플릿 제공
4. 로직 샌드박스 실행 환경 구축
5. 웹 UI 개발 (로직 에디터, 로직 목록)
6. 로직 포트폴리오 기능 개발
7. 시뮬레이터 구현 및 백테스트 기능
8. 실시간 데이터 연동 및 신호 생성
9. 브로커 어댑터 프로토타입 및 자동 매매 연동
10. 보안 격리 강화 및 운영 배포

초기 작업 리스트(우선순위)
- 저장소 초기화 및 기본 문서 추가 (PROJECT_PLAN.md, PROMPT.md)
- 샘플 데이터셋 추가(samples/)
- 로직 템플릿 추가(templates/logic_js.js)
- JavaScript 샌드박스 실행 환경 조사 및 프로토타입
- 로직 입출력 스키마 정의 (JSON Schema)
- 웹 UI 프레임워크 선정 및 초기 설정
- 백테스트 엔진 프로토타입
- GitHub Actions 기본 워크플로(lint, test)

리스크 및 고려사항
- 실제 거래 연결 시 자금·법적 리스크 발생: 시범계정(페이퍼) 우선 적용
- 사용자 제공 로직의 악의적 동작: 철저한 샌드박스와 권한 제한 필요
- JavaScript 실행 보안
  - 샌드박스 탈출 시도 방지: 정기적인 보안 업데이트 및 취약점 점검
  - 무한 루프 및 메모리 폭탄 방지: 실행 시간 및 메모리 제한 적용
  - 코드 인젝션 방지: 입력 검증 및 안전한 코드 평가
- 자동 매매 리스크
  - 버그로 인한 예상치 못한 거래: 충분한 테스트 및 페이퍼 트레이딩 검증 필수
  - 시장 급변 상황 대응: 킬 스위치 및 손실 한도 설정 필수
  - API 장애 시 거래 중단: 장애 감지 및 알림 시스템 구축
- 데이터 무결성
  - 실시간 데이터 지연 또는 누락: 데이터 품질 모니터링 및 대체 데이터 소스 준비
  - 과거 데이터 정확성: 신뢰할 수 있는 데이터 제공자 선정
- 확장성
  - 다수 사용자 동시 로직 실행: 분산 처리 및 큐잉 시스템 고려
  - 대량 백테스트 처리: 병렬 처리 및 클라우드 리소스 활용

## 기획 내용

아래 기능을 추상화 하여 다양한 환경에 유연하게 대응
- 계좌 조회
- 주문 전송

제공 채널
- 모바일앱, 모바일 앱은 Expo 로 작성
- PC 웹

알림기능
- 푸시, 이메일, 문자

포트폴리오 작성과 운용에 대한 튜토리얼
- 기본 제공 진입과 청산로직 조합
- 비중 분배
- 종목 선정
- 백테스트
- 수익 확인
- 5분단위 타이머 타입 + 이메일 알림 3건 무료

회원가입 및 로그인은 소셜계정 활용

기본 앱/웹에서는 실계좌 연결 기능 제공 안함

본인의 로직 코드 비밀보장

포트폴리오 수익률 공개

분산과 서버리스 아키텍처 적극 활용

로직을 포함하는 포트폴리오 패키징 구조 제시

다음과 같은 형태로 포트폴리오 동작 가능
- 백테스트 배치
- 연속형(또는 이벤트형) 상시 동작하면서 실시간 시세에 의해 동작
- 타이머형, 일정 시간마다 로직 동작. 타이머 타입같은 경우는 극단적으로, cron trigger 에 의해 동작하는 GitHub Actions 으로 동작 가능한 구조를 포함

권한 등급
- 백테스트만 가능
- 포워드테스트 가능
- 신호를 api 로 받음
- 특정시세에 대해 원하는 이평데이터 공급

별도 계약 또는 별도 사업 영역
- 계좌 위탁

참고: 이 문서는 초기 기획서 초안입니다. 세부 설계·아키텍처는 이후 기술 토론을 통해 확정합니다.
